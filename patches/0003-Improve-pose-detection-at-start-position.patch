From 635a21be3786207266024fdcf3b01784e4d83e8d Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sun, 7 Dec 2025 06:14:58 +0000
Subject: [PATCH 03/26] Improve pose detection at start position

- Lowered all confidence thresholds to 0.001 (minimum)
- CONFIDENCE_THRESHOLD: 0.001 for skeleton drawing
- POINT_CONFIDENCE_THRESHOLD: 0.001 for landmark detection
- Added debug logging for start frame pose detection
- Shows visibility values for key landmarks (shoulders, hips)
- This should detect poses even at the start position
---
 src/App.tsx | 23 ++++++++++++++++++++---
 1 file changed, 20 insertions(+), 3 deletions(-)

diff --git a/src/App.tsx b/src/App.tsx
index ae446ef..e4a5ec5 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -165,7 +165,7 @@ const calculateAngles = (
   const getPoint = (idx: number) => landmarks[idx];
   
   // ä¸»è¦ãªãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®ä¿¡é ¼åº¦ã‚’ãƒã‚§ãƒƒã‚¯
-  const CONFIDENCE_THRESHOLD = 0.05; // ã•ã‚‰ã«èªè­˜ç‡ã‚’å‘ä¸Šï¼ˆ0.1 â†’ 0.05ï¼‰
+  const CONFIDENCE_THRESHOLD = 0.001; // æ¥µé™ã¾ã§ä¸‹ã’ã¦ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã§ã‚‚æ¤œå‡º
 
   const leftHip = getPoint(23);
   const rightHip = getPoint(24);
@@ -2867,7 +2867,8 @@ const [notesInput, setNotesInput] = useState<string>("");
   ) => {
     // ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®š
     const isIPad = /iPad/i.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
-    const CONFIDENCE_THRESHOLD = isIPad ? 0.01 : 0.05;
+    // é–¾å€¤ã‚’æœ€ä½ã«ã—ã¦ã€ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã§ã‚‚æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«
+    const CONFIDENCE_THRESHOLD = 0.001; // æ¥µé™ã¾ã§ä¸‹ã’ã‚‹
     
     // ä¸»è¦ãªé–¢ç¯€ã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯
     const isValidPose = () => {
@@ -4285,7 +4286,7 @@ const [notesInput, setNotesInput] = useState<string>("");
         });
 
         ctx.fillStyle = "#f97316";
-        const POINT_CONFIDENCE_THRESHOLD = 0.15; // ğŸ”¥ å§¿å‹¢èªè­˜ç‡å‘ä¸Šã®ãŸã‚ä½ã‚ã«è¨­å®š
+        const POINT_CONFIDENCE_THRESHOLD = 0.001; // ğŸ”¥ æ¥µé™ã¾ã§ä¸‹ã’ã¦ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã§ã‚‚æ¤œå‡º
         landmarks.forEach((lm: FramePoseData["landmarks"][number]) => {
           if (lm.visibility > POINT_CONFIDENCE_THRESHOLD) {
             const trans = transformPoint(lm);
@@ -7057,12 +7058,28 @@ const [notesInput, setNotesInput] = useState<string>("");
                     setSectionStartFrame(newFrame);
                     setCurrentFrame(newFrame);
                     const pose = poseResults[newFrame];
+                    
+                    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
                     if (pose?.landmarks) {
+                      console.log(`ğŸ“ Frame ${newFrame} - å§¿å‹¢æ¤œå‡ºã‚ã‚Š`);
                       const leftHip = pose.landmarks[23];
                       const rightHip = pose.landmarks[24];
+                      const leftShoulder = pose.landmarks[11];
+                      const rightShoulder = pose.landmarks[12];
+                      
+                      console.log(`  å·¦è‚©: visibility=${leftShoulder?.visibility?.toFixed(3)}`);
+                      console.log(`  å³è‚©: visibility=${rightShoulder?.visibility?.toFixed(3)}`);
+                      console.log(`  å·¦è…°: visibility=${leftHip?.visibility?.toFixed(3)}`);
+                      console.log(`  å³è…°: visibility=${rightHip?.visibility?.toFixed(3)}`);
+                      
                       if (leftHip && rightHip) {
                         setSavedStartHipX((leftHip.x + rightHip.x) / 2);
+                        console.log(`  âœ… è…°ã®ä¸­å¿ƒç‚¹ã‚’ä¿å­˜`);
+                      } else {
+                        console.log(`  âš ï¸ è…°ãŒæ¤œå‡ºã§ããªã„`);
                       }
+                    } else {
+                      console.log(`âŒ Frame ${newFrame} - å§¿å‹¢æ¤œå‡ºãªã—`);
                     }
                     setStartLineOffset(0);
                     
-- 
2.39.5

