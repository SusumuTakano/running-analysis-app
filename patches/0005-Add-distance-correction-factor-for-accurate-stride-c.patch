From 784cd190ab7fb590da46a5875c74de2b214f31e4 Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sun, 7 Dec 2025 06:34:59 +0000
Subject: [PATCH 05/26] Add distance correction factor for accurate stride
 calculation

- Added manual distance correction factor in Step 5
- Users can adjust the factor if distance is calculated incorrectly
- Factor of 2.0 doubles the calculated distance (for when 10m shows as 5m)
- Factor of 0.5 halves the distance (for when 10m shows as 20m)
- Applied correction factor to distance calculation formula
- Helps fix issues where only half of the actual distance is detected
---
 src/App.tsx | 50 ++++++++++++++++++++++++++++++++++++++++++++++++--
 1 file changed, 48 insertions(+), 2 deletions(-)

diff --git a/src/App.tsx b/src/App.tsx
index a65becd..b6f2b53 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -919,6 +919,7 @@ const [notesInput, setNotesInput] = useState<string>("");
   
   // æ—§å¤‰æ•°ï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
   const [calibrationType, setCalibrationType] = useState<1 | 2 | 3 | null>(null);
+  const [distanceCorrectionFactor, setDistanceCorrectionFactor] = useState<number>(1.0); // è·é›¢è£œæ­£ä¿‚æ•°
   const [calibrationMode, setCalibrationMode] = useState<number>(0); // ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€²æ— (0-2: æ¥åœ°1â†’é›¢åœ°1â†’å®Œäº†)
   const [calibrationData, setCalibrationData] = useState<{
     contactFrame: number | null;
@@ -1899,8 +1900,8 @@ const [notesInput, setNotesInput] = useState<string>("");
       finishLineX = 1;
     }
     
-    // ãƒ”ã‚¯ã‚»ãƒ«â†’ãƒ¡ãƒ¼ãƒˆãƒ«å¤‰æ›ä¿‚æ•°
-    const distancePerNormalized = sectionLengthM / Math.abs(finishLineX - startLineX);
+    // ãƒ”ã‚¯ã‚»ãƒ«â†’ãƒ¡ãƒ¼ãƒˆãƒ«å¤‰æ›ä¿‚æ•°ï¼ˆè£œæ­£ä¿‚æ•°ã‚’é©ç”¨ï¼‰
+    const distancePerNormalized = (sectionLengthM * (distanceCorrectionFactor || 1.0)) / Math.abs(finishLineX - startLineX);
     const isLeftToRight = finishLineX > startLineX; // èµ°è¡Œæ–¹å‘
     
     // å„ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã®ã‚¹ã‚¿ãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®è·é›¢[m]ã‚’è¨ˆç®—
@@ -7486,6 +7487,51 @@ const [notesInput, setNotesInput] = useState<string>("");
               </div>
             </div>
 
+            {/* è·é›¢è£œæ­£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */}
+            <div style={{
+              background: '#fff3cd',
+              border: '2px solid #ffc107',
+              borderRadius: '8px',
+              padding: '16px',
+              margin: '20px 0',
+              textAlign: 'center'
+            }}>
+              <h4 style={{ color: '#856404', marginBottom: '12px', fontWeight: 'bold' }}>
+                âš ï¸ è·é›¢ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œãªã„å ´åˆã®è£œæ­£
+              </h4>
+              <p style={{ color: '#856404', marginBottom: '12px' }}>
+                å®Ÿéš›ã®è·é›¢ã¨ç•°ãªã‚‹å ´åˆã¯ã€è£œæ­£ä¿‚æ•°ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ï¼š
+              </p>
+              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px' }}>
+                <span>è£œæ­£ä¿‚æ•°:</span>
+                <input
+                  type="number"
+                  step="0.1"
+                  min="0.5"
+                  max="2.0"
+                  value={distanceCorrectionFactor || 1.0}
+                  onChange={(e) => {
+                    const factor = parseFloat(e.target.value);
+                    setDistanceCorrectionFactor(factor);
+                    console.log(`ğŸ“ è·é›¢è£œæ­£ä¿‚æ•°ã‚’è¨­å®š: ${factor}`);
+                  }}
+                  style={{
+                    width: '80px',
+                    padding: '5px',
+                    fontSize: '16px',
+                    textAlign: 'center'
+                  }}
+                />
+                <span style={{ fontSize: '12px', color: '#666' }}>
+                  (1.0 = è£œæ­£ãªã—ã€2.0 = 2å€ã€0.5 = åŠåˆ†)
+                </span>
+              </div>
+              <p style={{ fontSize: '12px', color: '#856404', marginTop: '10px' }}>
+                ä¾‹: 10måŒºé–“ãªã®ã«5mã¨è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ â†’ 2.0ã«è¨­å®š<br/>
+                ä¾‹: 10måŒºé–“ãªã®ã«20mã¨è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ â†’ 0.5ã«è¨­å®š
+              </p>
+            </div>
+
             <div className="wizard-actions">
               <button className="btn-ghost" onClick={() => setWizardStep(1)}>
                 æœ€åˆã«æˆ»ã‚‹
-- 
2.39.5

