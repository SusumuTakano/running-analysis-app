From 64a2f2a9b0a876c4fb9a080a230f18a7247d6d5d Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sun, 7 Dec 2025 06:05:21 +0000
Subject: [PATCH 01/26] Add pose estimation skip option and lower detection
 thresholds

- Added option to skip pose estimation in Step 4
- Lowered MediaPipe detection thresholds to 0.01 for maximum sensitivity
- Added retry option with maximum sensitivity
- Allow manual mode when pose estimation fails
- Users can now proceed to Step 5 even without pose data
- Manual start/finish point setting is available in Step 5
---
 src/App.tsx | 118 ++++++++++++++++++++++++++++++++++++----------------
 1 file changed, 82 insertions(+), 36 deletions(-)

diff --git a/src/App.tsx b/src/App.tsx
index 3411b49..867cd87 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -2547,28 +2547,28 @@ const [notesInput, setNotesInput] = useState<string>("");
       
       // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹ã”ã¨ã®æœ€é©åŒ–è¨­å®š
       let modelComplexity = 2; // ğŸ”¥ é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ï¼ˆç²¾åº¦å„ªå…ˆï¼‰
-      let minDetectionConfidence = 0.1; // ğŸ”¥ èªè­˜ç‡ã‚’å¤§å¹…ã«å‘ä¸Š
-      let minTrackingConfidence = 0.1; // ğŸ”¥ èªè­˜ç‡ã‚’å¤§å¹…ã«å‘ä¸Š
+      let minDetectionConfidence = 0.01; // ğŸ”¥ æœ€ä½é–¾å€¤ã§æœ€å¤§é™ã®èªè­˜ç‡
+      let minTrackingConfidence = 0.01; // ğŸ”¥ æœ€ä½é–¾å€¤ã§æœ€å¤§é™ã®èªè­˜ç‡
       let staticImageMode = false;
       let smoothLandmarks = true;
       
       if (isIPad) {
         console.log('ğŸ“± iPad detected - applying optimized settings');
         modelComplexity = 1; // ä¸­ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆiPadã¯ãƒ¡ãƒ¢ãƒªåˆ¶é™ã‚ã‚Šï¼‰
-        minDetectionConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
-        minTrackingConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minDetectionConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minTrackingConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
         staticImageMode = false; // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§é€£ç¶šæ€§ã‚’ä¿ã¤
         smoothLandmarks = true; // ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–
       } else if (isMobile) {
         console.log('ğŸ“± Mobile device detected - optimized settings');
         modelComplexity = 1; // ä¸­ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã¯ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼‰
-        minDetectionConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
-        minTrackingConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minDetectionConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minTrackingConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
       } else {
         console.log('ğŸ’» Desktop detected - high accuracy settings');
         modelComplexity = 2; // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã¯é«˜ç²¾åº¦
-        minDetectionConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
-        minTrackingConfidence = 0.05; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minDetectionConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
+        minTrackingConfidence = 0.01; // èªè­˜ç‡ã‚’æœ€å¤§åŒ–
       }
       
       console.log(`ğŸ”§ Setting options: modelComplexity=${modelComplexity}, detection=${minDetectionConfidence}, tracking=${minTrackingConfidence}`);
@@ -6813,44 +6813,90 @@ const [notesInput, setNotesInput] = useState<string>("");
               <div className="progress-status">{status}</div>
             </div>
             
-            {/* äººç‰©æ‰‹å‹•é¸æŠã‚ªãƒ—ã‚·ãƒ§ãƒ³ */}
-            {poseProgress < 10 && (
-              <div style={{
-                margin: '20px auto',
-                maxWidth: '500px',
-                padding: '16px',
-                background: '#fef3c7',
-                borderRadius: '8px',
-                border: '2px solid #f59e0b',
-                textAlign: 'center'
-              }}>
-                <p style={{ fontWeight: 'bold', color: '#92400e', marginBottom: '12px' }}>
-                  ğŸ¯ å§¿å‹¢æ¨å®šãŒã†ã¾ãæ¤œå‡ºã§ããªã„å ´åˆ
-                </p>
+            {/* å§¿å‹¢æ¨å®šã®ä»£æ›¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰ */}
+            <div style={{
+              margin: '20px auto',
+              maxWidth: '600px',
+              padding: '20px',
+              background: '#fef3c7',
+              borderRadius: '8px',
+              border: '2px solid #f59e0b'
+            }}>
+              <p style={{ fontWeight: 'bold', color: '#92400e', marginBottom: '16px', fontSize: '1.1rem' }}>
+                âš ï¸ å§¿å‹¢æ¨å®šã®ä»£æ›¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³
+              </p>
+              
+              <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap', justifyContent: 'center' }}>
                 <button
-                  className="btn-secondary"
                   onClick={() => {
-                    setIsPersonSelectMode(true);
-                    // æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
-                    if (framesRef.current[0] && canvasRef.current) {
-                      const ctx = canvasRef.current.getContext('2d');
-                      if (ctx) {
-                        ctx.putImageData(framesRef.current[0], 0, 0);
-                      }
-                    }
+                    // å§¿å‹¢æ¨å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã¸
+                    console.log('å§¿å‹¢æ¨å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã¸');
+                    setIsPoseProcessing(false);
+                    setPoseProgress(100);
+                    setStatus('âš ï¸ æ‰‹å‹•è¨­å®šãƒ¢ãƒ¼ãƒ‰ï¼ˆå§¿å‹¢æ¨å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰');
+                    // ç©ºã®ãƒãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
+                    const emptyPoseResults = new Array(framesRef.current.length).fill(null);
+                    setPoseResults(emptyPoseResults);
+                    // Step 5ã¸é€²ã‚€
+                    setTimeout(() => {
+                      setWizardStep(5);
+                    }, 500);
                   }}
                   style={{
-                    background: '#f59e0b',
+                    background: '#ef4444',
                     color: 'white',
-                    padding: '10px 20px',
+                    padding: '12px 24px',
                     borderRadius: '6px',
-                    fontWeight: 'bold'
+                    fontWeight: 'bold',
+                    cursor: 'pointer',
+                    fontSize: '1rem'
+                  }}
+                  disabled={isPoseProcessing}
+                >
+                  â­ï¸ ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ‰‹å‹•è¨­å®šã¸
+                </button>
+                
+                <button
+                  onClick={() => {
+                    // æ¤œå‡ºæ„Ÿåº¦ã‚’æœ€ä½ã«ã—ã¦å†è©¦è¡Œ
+                    console.log('æœ€ä½é–¾å€¤ã§å†è©¦è¡Œ');
+                    setIsPoseProcessing(false);
+                    setPoseProgress(0);
+                    setStatus('ğŸ”§ æ¤œå‡ºæ„Ÿåº¦ã‚’æœ€å¤§ã«ã—ã¦å†è©¦è¡Œä¸­...');
+                    // é…å»¶å¾Œã«å†å®Ÿè¡Œ
+                    setTimeout(() => {
+                      runPoseEstimation();
+                    }, 500);
                   }}
+                  style={{
+                    background: '#10b981',
+                    color: 'white',
+                    padding: '12px 24px',
+                    borderRadius: '6px',
+                    fontWeight: 'bold',
+                    cursor: 'pointer',
+                    fontSize: '1rem'
+                  }}
+                  disabled={isPoseProcessing}
                 >
-                  æ‰‹å‹•ã§äººç‰©é ˜åŸŸã‚’é¸æŠ
+                  ğŸ”§ æ„Ÿåº¦æœ€å¤§ã§å†è©¦è¡Œ
                 </button>
               </div>
-            )}
+              
+              <div style={{ 
+                fontSize: '0.85rem', 
+                color: '#92400e',
+                marginTop: '16px',
+                padding: '12px',
+                background: 'rgba(255,255,255,0.5)',
+                borderRadius: '6px'
+              }}>
+                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼š</strong><br/>
+                â€¢ å§¿å‹¢æ¨å®šãŒã†ã¾ãã„ã‹ãªã„å ´åˆã¯ã€Œã‚¹ã‚­ãƒƒãƒ—ã€ã‚’é¸æŠã—ã¦ãã ã•ã„<br/>
+                â€¢ Step 5ã§æ‰‹å‹•ã§ã‚¹ã‚¿ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥åœ°ç‚¹ã‚’è¨­å®šã§ãã¾ã™<br/>
+                â€¢ æ¥åœ°ãƒ»é›¢åœ°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚‚æ‰‹å‹•ã§èª¿æ•´å¯èƒ½ã§ã™
+              </div>
+            </div>
             
             {status.includes('âŒ') && (
               <div className="wizard-actions">
-- 
2.39.5

