From 3fa3601cba22dbd617a716f7a66ac2a7e751365d Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sat, 20 Dec 2025 13:45:49 +0000
Subject: [PATCH 19/26] fix: Preserve all steps after TrueStride recalculation

CRITICAL BUG:
- After TrueStride recalculation, only 5 steps were displayed
- Root cause: Array reconstruction logic cleared finalSteps

SOLUTION:
- realStepsForStride is a filtered reference to finalSteps elements
- When we update stride in realStepsForStride, finalSteps is also updated
- No need to reconstruct array, just re-sort

RESULT:
- All steps (real + interpolated) are preserved
- Only real steps have recalculated TrueStride
- Interpolated steps kept for display continuity
---
 src/App.tsx | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/src/App.tsx b/src/App.tsx
index d8cbb04..36f789d 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -6868,16 +6868,15 @@ const handleNewMultiCameraStart = (run: Run, segments: RunSegment[]) => {
     
     console.log("\nâœ… TrueStride recalculation complete (ChatGPT method)\n");
     
-    // è£œé–“ã‚¹ãƒ†ãƒƒãƒ—ã¯ãã®ã¾ã¾ä¿æŒï¼ˆè¡¨ç¤ºç”¨ï¼‰
-    const interpolatedSteps = finalSteps.filter(s => s.isInterpolated === true);
-    
-    // æœ€çµ‚çš„ãªã‚¹ãƒ†ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰ï¼ˆrealStepsForStride + interpolatedStepsï¼‰
-    finalSteps.length = 0;
-    finalSteps.push(...realStepsForStride, ...interpolatedSteps);
+    // ðŸ” é‡è¦: realStepsForStrideã¯æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€finalStepsã‚‚è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹
+    // ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ã§ä½œæˆã—ãŸrealStepsForStrideã¯å…ƒã®finalStepsã®è¦ç´ ã¸ã®å‚ç…§ã‚’ä¿æŒï¼‰
+    // è£œé–“ã‚¹ãƒ†ãƒƒãƒ—ã¯æ—¢ã«finalStepsã«å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€å†æ§‹ç¯‰ã¯ä¸è¦
     
     // globalDistã§å†ã‚½ãƒ¼ãƒˆï¼ˆæ™‚ç³»åˆ—é †ã«æˆ»ã™ï¼‰
     finalSteps.sort((a, b) => (a.distanceAtContact || 0) - (b.distanceAtContact || 0));
     
+    console.log(`\nðŸ“Š Final steps after TrueStride recalculation: ${finalSteps.length} (real: ${realStepsForStride.length}, interpolated: ${finalSteps.filter(s => s.isInterpolated).length})`);
+    
     // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†å‰²ã‚Šå½“ã¦
     finalSteps.forEach((step, idx) => {
       step.index = idx;
-- 
2.39.5

