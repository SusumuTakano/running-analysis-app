From 6bcfd804447cefd5ba40c84a02340e1aae358924 Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sun, 7 Dec 2025 06:24:58 +0000
Subject: [PATCH 04/26] Add manual pose marking for start position
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- Added 'æ‰‹å‹•ã§äººç‰©ä½ç½®ã‚’æŒ‡å®š' button when pose is not detected
- Users can click on the canvas to manually mark hip position
- Creates artificial pose data with the clicked position
- Allows setting start point even when pose detection fails
- Displays crosshair cursor during manual selection
- Saves manual pose data to enable distance calculation
---
 src/App.tsx | 56 +++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 56 insertions(+)

diff --git a/src/App.tsx b/src/App.tsx
index e4a5ec5..a65becd 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -7123,6 +7123,62 @@ const [notesInput, setNotesInput] = useState<string>("");
                     <span style={{ fontSize: '0.8rem', fontWeight: 'normal', color: '#991b1b' }}>
                       è·é›¢è¨ˆç®—ãŒä¸æ­£ç¢ºã«ãªã‚Šã¾ã™ã€‚å§¿å‹¢ãŒèªè­˜ã•ã‚Œã¦ã„ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
                     </span>
+                    <button
+                      onClick={() => {
+                        // æ‰‹å‹•ã§è…°ã®ä½ç½®ã‚’æŒ‡å®š
+                        const canvas = displayCanvasRef.current;
+                        if (!canvas) return;
+                        
+                        const handleCanvasClick = (e: MouseEvent) => {
+                          const rect = canvas.getBoundingClientRect();
+                          const x = (e.clientX - rect.left) / canvas.width;
+                          const y = (e.clientY - rect.top) / canvas.height;
+                          
+                          console.log(`ğŸ¯ æ‰‹å‹•ã§ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®ã‚’è¨­å®š: x=${x.toFixed(3)}, y=${y.toFixed(3)}`);
+                          setSavedStartHipX(x);
+                          
+                          // æ‰‹å‹•ã§ä½œæˆã—ãŸãƒãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
+                          if (!poseResults[sectionStartFrame]) {
+                            const manualLandmarks = Array(33).fill(null).map(() => ({
+                              x: x,
+                              y: y,
+                              z: 0,
+                              visibility: 0.5
+                            }));
+                            // è…°ã®ä½ç½®ã‚’è¨­å®š
+                            manualLandmarks[23] = { x: x - 0.02, y: y, z: 0, visibility: 1 };
+                            manualLandmarks[24] = { x: x + 0.02, y: y, z: 0, visibility: 1 };
+                            
+                            const newPoseResults = [...poseResults];
+                            newPoseResults[sectionStartFrame] = { landmarks: manualLandmarks };
+                            setPoseResults(newPoseResults);
+                            console.log(`âœ… æ‰‹å‹•ãƒãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ`);
+                          }
+                          
+                          // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤
+                          canvas.removeEventListener('click', handleCanvasClick);
+                          canvas.style.cursor = 'default';
+                          setStatus('âœ… ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®ã‚’æ‰‹å‹•ã§è¨­å®šã—ã¾ã—ãŸ');
+                        };
+                        
+                        canvas.addEventListener('click', handleCanvasClick);
+                        canvas.style.cursor = 'crosshair';
+                        setStatus('ğŸ‘† ç”»åƒä¸Šã§äººç‰©ã®è…°ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
+                      }}
+                      style={{
+                        display: 'block',
+                        margin: '10px auto 0',
+                        padding: '8px 16px',
+                        background: '#f59e0b',
+                        color: 'white',
+                        border: 'none',
+                        borderRadius: '6px',
+                        cursor: 'pointer',
+                        fontWeight: 'bold'
+                      }}
+                    >
+                      ğŸ¯ æ‰‹å‹•ã§äººç‰©ä½ç½®ã‚’æŒ‡å®š
+                    </button>
                   </div>
                 )}
               </div>
-- 
2.39.5

