From efd9c205093532aab8476dc26ba601f487c9403f Mon Sep 17 00:00:00 2001
From: SusumuTakano <genspark_dev@genspark.ai>
Date: Sat, 20 Dec 2025 13:31:31 +0000
Subject: [PATCH 17/26] debug: Add ChatGPT requested detailed step-by-step
 logging

ChatGPT specifically requested detailed logs for each step:
- contact_globalDist
- next_contact_globalDist
- TrueStride (difference)
- Contribution (after clipping)
- isInterpolated flag
- segmentId
- contactFrame

This will help identify the exact point where stride calculation diverges
from single-camera mode (1.57m) vs multi-camera mode (1.35m).

Expected logs will show:
- Exact globalDistance for each step
- Stride calculation process
- Any discrepancies in distance/stride values

This is critical diagnostic information to find root cause.
---
 src/App.tsx | 34 +++++++++++++++++++++++++++-------
 1 file changed, 27 insertions(+), 7 deletions(-)

diff --git a/src/App.tsx b/src/App.tsx
index b7bc029..2f20c04 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -6819,11 +6819,27 @@ const handleNewMultiCameraStart = (run: Run, segments: RunSegment[]) => {
     // ğŸ¯ ã‚°ãƒ­ãƒ¼ãƒãƒ«è·é›¢ã‹ã‚‰ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰ã‚’å†è¨ˆç®—ï¼ˆChatGPTææ¡ˆï¼‰
     // ãŸã ã—ã€è£œé–“ã‚¹ãƒ†ãƒƒãƒ—ã¯é™¤å¤–ï¼ˆè£œé–“ã‚¹ãƒ†ãƒƒãƒ—ã¯å®Ÿæ¸¬å€¤ã§ã¯ãªã„ãŸã‚ï¼‰
     console.log("ğŸ”§ Recalculating strides from globalDistance (excluding interpolated steps)...");
+    console.log("\nğŸ“‹ === ChatGPT Requested Log: Detailed Step Analysis ===");
     
     for (let i = 0; i < finalSteps.length; i++) {
+      const currentDist = finalSteps[i].distanceAtContact || 0;
+      const nextDist = finalSteps[i + 1]?.distanceAtContact;
+      
+      // ğŸ¯ ChatGPTãŒè¦æ±‚ã™ã‚‹è©³ç´°ãƒ­ã‚°
+      console.log(`\n[Step ${i}]`);
+      console.log(`  contact_globalDist: ${currentDist.toFixed(3)}m`);
+      if (nextDist != null) {
+        console.log(`  next_contact_globalDist: ${nextDist.toFixed(3)}m`);
+        console.log(`  TrueStride (next - current): ${(nextDist - currentDist).toFixed(3)}m`);
+      }
+      console.log(`  isInterpolated: ${finalSteps[i].isInterpolated === true}`);
+      console.log(`  segmentId: ${finalSteps[i].segmentId ?? 'N/A'}`);
+      console.log(`  contactFrame: ${finalSteps[i].contactFrame}`);
+      console.log(`  current stride value: ${finalSteps[i].stride?.toFixed(3) ?? 'N/A'}m`);
+      
       if (i === 0) {
         // æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ãã®ã¾ã¾
-        console.log(`  Step ${i}: Initial step at ${finalSteps[i].distanceAtContact?.toFixed(2)}m, stride=${finalSteps[i].stride?.toFixed(2)}m (kept as-is)`);
+        console.log(`  â†’ Action: Initial step, kept as-is`);
         continue;
       }
       
@@ -6832,31 +6848,35 @@ const handleNewMultiCameraStart = (run: Run, segments: RunSegment[]) => {
       const isPrevInterpolated = finalSteps[i - 1].isInterpolated === true;
       
       if (isCurrentInterpolated) {
-        console.log(`  Step ${i}: Interpolated step at ${finalSteps[i].distanceAtContact?.toFixed(2)}m, stride=${finalSteps[i].stride?.toFixed(2)}m (kept as-is, not recalculated)`);
+        console.log(`  â†’ Action: Interpolated step, kept as-is`);
         continue;
       }
       
       if (isPrevInterpolated) {
-        console.log(`  Step ${i}: After interpolated step at ${finalSteps[i].distanceAtContact?.toFixed(2)}m, stride=${finalSteps[i].stride?.toFixed(2)}m (kept as Homography-corrected value)`);
+        console.log(`  â†’ Action: After interpolated, kept as Homography value`);
         continue;
       }
       
       // å®Ÿæ¸¬ã‚¹ãƒ†ãƒƒãƒ—é–“ã®ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰ã®ã¿å†è¨ˆç®—
-      const currentDist = finalSteps[i].distanceAtContact || 0;
       const prevDist = finalSteps[i - 1].distanceAtContact || 0;
       const recalculatedStride = currentDist - prevDist;
       
+      console.log(`  prev_contact_globalDist: ${prevDist.toFixed(3)}m`);
+      console.log(`  Recalculated stride (current - prev): ${recalculatedStride.toFixed(3)}m`);
+      
       // ç•°å¸¸å€¤ãƒã‚§ãƒƒã‚¯ï¼ˆ0.5mæœªæº€ã€3.0mè¶…ã¯è­¦å‘Šï¼‰
       if (recalculatedStride < 0.5 || recalculatedStride > 3.0) {
-        console.warn(`  âš ï¸ Step ${i}: Unusual stride ${recalculatedStride.toFixed(2)}m (dist: ${prevDist.toFixed(2)}â†’${currentDist.toFixed(2)}m)`);
-      } else {
-        console.log(`  Step ${i}: Stride recalculated from globalDistance: ${recalculatedStride.toFixed(2)}m (was ${finalSteps[i].stride?.toFixed(2) ?? 'N/A'}m)`);
+        console.warn(`  âš ï¸ WARNING: Unusual stride ${recalculatedStride.toFixed(3)}m`);
       }
       
+      console.log(`  â†’ Action: UPDATE stride from ${finalSteps[i].stride?.toFixed(3) ?? 'N/A'}m to ${recalculatedStride.toFixed(3)}m`);
+      
       finalSteps[i].stride = recalculatedStride;
       finalSteps[i].fullStride = recalculatedStride;
     }
     
+    console.log("\n=== End of Detailed Step Analysis ===\n");
+    
     // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†å‰²ã‚Šå½“ã¦
     finalSteps.forEach((step, idx) => {
       step.index = idx;
-- 
2.39.5

